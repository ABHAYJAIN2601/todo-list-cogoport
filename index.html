<!DOCTYPE html>
<html>
<head>
<title>todo-list</title>
<link href='https://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet'>
<link rel="stylesheet" href = './index.css'/>
</head>
  <body>
    <div class="todo-app">
        <h1 class="title">To-do list</h1>
        <p class="qoute">“Each day I will accomplish one thing on my to do list.”</p>
      <div class="input-section">
        <input id="todoInput" type="text" placeholder="Add item..." />
        <button id="addBtn" type="submit" class="add">Add</button>
      
      </div>
      <div class="todos">
        <ul class="todo-list">
        </ul>
      </div>
    </div>
  </body>
  <script>
    let todos = JSON.parse(localStorage.getItem("todos")) || [];
    let editIndex = -1;
    const todoForm = document.querySelector(".input-section");
    const todoInput = document.querySelector("#todoInput");
    const todoList = document.querySelector(".todo-list");
    const addButton = document.querySelector("#addBtn");
    const todo_main = document.querySelector(".todos");

function saveTodos() {
  localStorage.setItem("todos", JSON.stringify(todos));
}

function getData(){
    fetch('https://jsonplaceholder.typicode.com/todos').then((response)=>{
        if(!response.ok){
            throw new Error('error');
        }
        return response.json();
    }).then((data)=>{
        todos = data;
        saveTodos();
    }).catch((error)=>{
        console.loh(error);
    })
}
if(todos.length <= 200) getData();

async function renderTodos() {
  todoList.innerHTML = "";

  todos.forEach((todo, index) => {
    const li = document.createElement("li");
    li.className = "li";
    li.setAttribute('id',index);
    const checkbox = document.createElement("input");
    checkbox.className = "form-check-input";
    checkbox.type = "checkbox";
    checkbox.checked = todo.completed;
    checkbox.addEventListener("change", () => toggleTodoCompleted(index));

    const label = document.createElement("label");
    label.className = "form-check-label";

    const spanText = document.createElement("span");
    spanText.className = "todo-text";
    spanText.id = 'todoText';
    spanText.textContent = todo.title;

    const editInput = document.createElement("input");
    editInput.type = 'text';
    editInput.id = 'editInput';
    editInput.className = "edit-input";
    editInput.style.display = "none";
    editInput.value = todo.title;

    const deleteButton = document.createElement("span");
    deleteButton.className = "span-button";
    deleteButton.innerHTML = 'Delete';
    deleteButton.id = 'delete-button';
    deleteButton.addEventListener("click", () => deleteTodo(index));

    const editButton = document.createElement("span");
    editButton.className = "span-button";
    editButton.id = 'editButton'
    editButton.innerHTML = 'Edit';
    editButton.addEventListener("click", () => editTodo(index));

    const updateButton = document.createElement("button");
    updateButton.className = "span-button";
    updateButton.innerHTML = 'Save';
    updateButton.id = "update-button";
    updateButton.style.display = 'none';
    updateButton.addEventListener("click", () => addTodo());

    li.appendChild(checkbox);
    li.appendChild(label);
    li.appendChild(spanText);
    li.appendChild(editInput);
    li.appendChild(editButton);
    li.appendChild(updateButton);
    li.appendChild(deleteButton);
    
    todoList.appendChild(li);

  });
}
function addTodo() {
    const todoText = todoInput.value.trim();
    todoForm.addEventListener("click", function(event){
        event.preventDefault()
    });
    if(todoText =='' && editIndex ==-1)return false;

    if (editIndex === -1) {
      todos.unshift({
        title: todoText,
        completed: false,
      });
    } else {
      var elements = document.getElementById(editIndex);
      let editInput = elements.querySelector('#editInput');
      todos[editIndex].title = editInput.value;
      editIndex = -1;
      addButton.style.display = "inline";
    }

    saveTodos();
    renderTodos();
    todoInput.value = "";
}

function editTodo(id) {
  var elements = document.getElementById(id);
  let editButton = elements.querySelector('#editButton');
  editButton.style.display = 'none';
  let updateButton = elements.querySelector('#update-button');
  updateButton.style.display = 'block';
  let taskTitle = elements.querySelector('#todoText');
  taskTitle.style.display = 'none';
  let editInput = elements.querySelector('#editInput');
  editInput.style.display = 'block';
  let deleteButton = elements.querySelector('#delete-button');
  deleteButton.style.display = 'none';
  editIndex = index;
}

function toggleTodoCompleted(id) {
  todos[id].completed = !todos[id].completed;
  saveTodos();
  renderTodos();
}

function deleteTodo(id) {
  todos.splice(id, 1);
  saveTodos();
  renderTodos();
}

addButton.addEventListener("click", addTodo);
renderTodos();
  </script>
</html>
